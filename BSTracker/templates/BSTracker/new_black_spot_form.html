{% extends 'main.html' %}
{% block content %}
{% load static %}
{% include 'newmain.html' %}
<div class="bg-modal">
    <div class="modal-contents">
            <h2 class="fs-title">Ajouter un point noir</h2>
                <form id="msform" action="" method="post"  enctype="multipart/form-data">
                    {% csrf_token %}
                    <!-- progressbar -->
                    <ul id="progressbar">
                        <li class="active">Etape 1</li>
                        <li>Etape 2</li>
                        <li>Etape 3</li>
                        <li>Etape 4</li>
                        <li>Etape 5</li>
                    </ul>
                    <!-- fieldsets -->
                    <div class="fieldsets">
                        <fieldset>
                            <h2 class="fs-subtitle">Saisissez les informations suivantes</h2>
                            <div class="inputprop">
                                <span>Point noir</span>
                                <input type="text" name="Pname" placeholder="Point noir"/>
                            </div>
                            <div class="inputprop">
                                <span>Commune</span>
                                <input type="text" name="Pcommune" placeholder="Commune"/>
                            </div>
                            
                            <div class="inputprop">
                                <span>Localisation</span>
                                 <input type="text" name="Plocalisation" placeholder="Localisation"/>
                            </div>
                            
                            <div class="inputprop">
                                <span>PK</span>
                                <input type="text" name="Ppkvalue" placeholder="PK"/>
                            </div>
                          
                            <input type="button" name="next" class="next action-button" value="Suivant"/>
                        </fieldset>
                        <fieldset>
                            <h2 class="fs-subtitle">Saisissez le nombre de victimes pour chaque catégorie</h2>
                            <div class="inputprop">
                                <span>Nombre des accidents</span>
                                <input type="number" name="Pnbaccidents" placeholder="Introduisez le nombre d'accidents"/>
                            </div>
                            
                            <div class="inputprop">
                                <span>Nombre de tués</span>
                                <input type="number" name="Pnbdead" placeholder="Introduisez le nombre de tués"/>
                            </div>
                           
                            <div class="inputprop">
                                <span>Nombre de blessés</span>
                                <input type="number" name="Pnbinjured" placeholder="Introduisez le nombre de blessés"/>
                            </div>
                           
                            <!-- <input type="button" name="previous" class="previous action-button-previous" value="Previous"/> -->
                            <input type="button" name="next" class="next action-button" value="Suivant"/>
                        </fieldset>
                        <fieldset>
                            <h2 class="fs-subtitle">Saisissez le nombre de victimes pour chaque catégorie</h2>
                            <div class="inputprop">
                            <span>Problèmes/causes</span>
                            <select name="causes">
                                <option value="causes"  selected hidden style="color: rgb(233, 231, 231);">Problèmes/causes</option>
                                <option value="1">Excès de vitesse</option>
                                <option value="2">Baisse de vigilance du conducteur </option>
                                <option value="3">Perte de contrôle du véhicule </option>
                                <option value="4">Route défectueuse </option>
                                <option value="5">Freinage défectueux </option>
                            </select>
                            </div>
                            <div class="inputprop">
                            <span>Mesures</span>
                            <input type="text" name="Pmesures" placeholder="Mesures prises ou envisagées"/>
                            </div>
                            <div class="inputprop">
                            <span>Observations</span>
                            <input type="text" name="Premarks" placeholder="Observations"/>
                            </div>
                            <!-- <input type="button" name="previous" class="previous action-button-previous" value="Previous"/> -->
                            <input type="button" name="next" class="next action-button" value="Suivant"/>
                        </fieldset>
                        <fieldset>
                            <h2 class="fs-subtitle">Télécharger les photos du point noir routier</h2>
                            <input type="file"  name="image" class="form-control">
                            <!-- <input type="button" name="previous" class="previous action-button-previous" value="Previous"/> -->
                            <input type="button" name="next" class="next action-button" value="Suivant"/>
                        </fieldset>
                        <fieldset>
                            <h2 class="fs-subtitle"> Choisissez l'emplacement exacte sur la carte </h2>
                            <div class="map-style">
                                <div style="display: flex ; flex-direction:column; margin-right: 20px;"> 
                                    <span> Latitude : </span>
                                    <input style="width:150px ;" id="lat" name="latitude" />  
                                    <span> longitude : </span>
                                    <input style="width:150px ;" id="lon" name="longitude" />
                                </div>
                                <div id="map-form">  </div>
                            </div>
                           
                            <script>
                               var loc_map = JSON.parse('{{loc}}');
                            
    
                                var map = L.map('map-form').setView([loc_map.lat, loc_map.lon], 10);
                                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                    maxZoom: 19,
                                    attribution: '© OpenStreetMap',
                                    
                                }).addTo(map);
                                var theMarker = {};
    
                              
                        
                                map.on('click',function(e){
                                lat = e.latlng.lat;
                                lon = e.latlng.lng;
                        
                                console.log("You clicked the map at LAT: "+ lat+" and LONG: "+lon );
                                document.getElementById('lat').value = lat;
                                document.getElementById('lon').value = lon;
                                    //Clear existing marker, 
                                    if (theMarker != undefined) {
                                                map.removeLayer(theMarker);
                                        };
                                        
    
                                    //Add a marker to show where you clicked.
                                    theMarker = L.marker([lat,lon]).addTo(map);  
                                                            });
    
                                            
                            </script>
                            <!-- <input type="button" name="previous" class="previous action-button-previous" value="Previous"/> -->
                            <input type="submit" name="submit" class="submit action-button" value="Confirmer"/>
                        </fieldset>
                    </div>
                </form>
            </div>
    </div>
    <script>
           
            //jQuery time
        var current_fs, next_fs, previous_fs; //fieldsets
        var left, opacity, scale; //fieldset properties which we will animate
        var animating; //flag to prevent quick multi-click glitches

        $(".next").click(function(){
            if(animating) return false;
            animating = true;

            current_fs = $(this).parent();
            next_fs = $(this).parent().next();

            //activate next step on progressbar using the index of next_fs
            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");

            //show the next fieldset
            next_fs.show();
            //hide the current fieldset with style
            current_fs.animate({opacity: 0}, {
                step: function(now, mx) {
                    //as the opacity of current_fs reduces to 0 - stored in "now"
                    //1. scale current_fs down to 80%
                    scale = 1 - (1 - now) * 0.2;
                    //2. bring next_fs from the right(50%)
                    left = (now * 50)+"%";
                    //3. increase opacity of next_fs to 1 as it moves in
                    opacity = 1 - now;
                    current_fs.css({
                'transform': 'scale('+scale+')',
                'display' : 'flex',
                // 'position': 'absolute'
            });
                    next_fs.css({'opacity': opacity, 'display':'flex'});
                },
                // duration: 800,
                complete: function(){
                    current_fs.hide();
                    animating = false;
                },
                //this comes from the custom easing plugin
                easing: 'easeInOutBack'
            });
        });
        $(".previous").click(function(){
            if(animating) return false;
            animating = true;

            current_fs = $(this).parent();
            previous_fs = $(this).parent().prev();

            //de-activate current step on progressbar
            $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

            //show the previous fieldset
            previous_fs.show();
            //hide the current fieldset with style
            current_fs.animate({opacity: 0}, {
                step: function(now, mx) {
                    //as the opacity of current_fs reduces to 0 - stored in "now"
                    //1. scale previous_fs from 80% to 100%
                    scale = 0.8 + (1 - now) * 0.2;
                    //2. take current_fs to the right(50%) - from 0%
                    left = ((1-now) * 50)+"%";
                    //3. increase opacity of previous_fs to 1 as it moves in
                    opacity = 1 - now;
                    // current_fs.css({'left': left});
                    previous_fs.css({'transform': 'scale('+scale+')', 'opacity': opacity});
                },
                // duration: 800,
                complete: function(){
                    current_fs.hide();
                    animating = false;
                },
                //this comes from the custom easing plugin
                easing: 'easeInOutBack'
            });
        });

    </script>

    {%  endblock content %}