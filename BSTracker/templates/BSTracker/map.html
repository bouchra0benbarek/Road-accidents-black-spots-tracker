{% extends 'main.html' %}
{% load static %}
{% block content %}
{% include 'newmain.html' %}
<div>
    <div id="map">
    </div>
    <!-- <div class="filter-box">
        <div class="filter-items">
            <div class="filter-item">
                <span> Wilaya </span>
                <select name="wilayas" class="item">
                    <option value="wilaya" selected style="color: rgb(233, 231, 231);">Wilaya</option>
                    {% for w in wilayas %}
                    <option class="selected">{{w.name_wilaya}}</option>
                    {% endfor %}
                </select> 
            </div>
            <div class="filter-item">
                <span>Année</span>
                <select name="annee" class="item">
                    <option value="" selected hidden style="color: rgb(233, 231, 231);">Année</option>
                    <option>2030</option>
                    <option>2029</option>
                    <option>2028</option>
                    <option>2027</option>
                    <option>2026</option>
                    <option>2025</option>
                    <option>2024</option>
                    <option>2023</option>
                    <option>2022</option>
                    <option>2021</option>
                    <option>2020</option>
                    <option>2019</option>
                </select>
            </div>
            <div class="filter-item">
                <span>Trimestre</span>
                <select name="trimestre" class="item">
                    <option value="" disabled selected hidden style="color: rgb(233, 231, 231);"> Trimestre</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                </select>
            </div>
            <div class="filter-item">
                <span> Gravité </span>
                <select name="gravité" class="item">
                    <option value="" disabled selected hidden style="color: rgb(233, 231, 231);">Gravité</option>
                    <option>Fatal</option>
                    <option>Grave</option>
                    <option>Léger</option>
                </select>
            </div>
            <button type="submit" class="rech-btn">Rechercher</button>
        </div>
    </div> -->
    <script>
        var map = L.map('map').setView([28.033886, 1.659626], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            
            attribution: '© OpenStreetMap'
        }).addTo(map);


        var popupOptions =
        {
        'maxWidth': '800',
        'className' : 'popup'
        }


        var map_bs = JSON.parse('{{map_bs}}')
        var map_acc = JSON.parse('{{map_acc}}')

        

        var greenIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            iconSize:     [25, 41], // size of the icon
            // iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
            // popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });

    for (i in map_bs){
        var marker = L.marker([map_bs[i].loc[0], map_bs[i].loc[1]], {icon : greenIcon}).addTo(map)
        var popup_content = "<b>Détails sur le point noir</b>"+'<br>'+ "Point noir : " + map_bs[i].point_noir + '<br>'+ 'Commune : '+map_bs[i].commune + '<br>'+ "Nombre d'accidents : "+ map_bs[i].nb_acc +
            "<br>"+"Nombre de blessés : "+map_bs[i].nb_blesses + '<br>'+"Nombre de tués : "+ map_bs[i].nb_tues
        L.marker([map_bs[i].loc[0], map_bs[i].loc[1]], {icon : greenIcon}).addTo(map).bindPopup( popup_content, popupOptions);
    }


    function getColor(d) {
        console.log(d)
    return d > 30 ? "red" :
           d > 12  ? "orange" :
           d > 10  ? "green" :
                     "yellow";
    }
    function style_(feature) {
    return {
        color: getColor(feature),
        weight: 2,
    };
    
}

        function circleWithText(latLng, txt, circleOptions) {
        var icon = L.divIcon({
            html: '<div class="txt">' + txt + '</div>',
            className: 'circle-with-txt',
            iconSize: [10, 0],
        });
        console.log(circleOptions.color)
        var circle = L.circleMarker(latLng, circleOptions);
        var marker = L.marker(latLng, {
            icon: icon
        });
        var group = L.layerGroup([circle, marker]);
        return(group);
        }

        for (j in map_acc){
            circleWithText([map_acc[j].loc[0], map_acc[j].loc[1]], map_acc[j].total_acc, {radius: 50, weight:2, color : style_(map_acc[j].total_acc).color, fillOpacity:0.6}).addTo(map);
        }
      
    </script>
</div>

{% endblock content%}